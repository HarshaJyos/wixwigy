"use strict";(self.webpackChunkcodox_lexical=self.webpackChunkcodox_lexical||[]).push([[979],{979:(e,t,n)=>{n.r(t),n.d(t,{UpdateInlineImageDialog:()=>E,default:()=>y});var l=n(9019),a=n(5532),s=n(9837),i=n(8268),r=n(9887),o=n(4736),c=n(8578),d=n(407),u=n(5043),p=n(1682),h=n(4136),f=n(6716),g=n(2317),m=n(2031),x=n(3509),v=n(5138),j=n(4481),C=n(5909),b=n(9269),w=n(579);const k=new Set;function _(e){let{altText:t,className:n,imageRef:l,src:a,width:s,height:i,position:r}=e;return function(e){if(!k.has(e))throw new Promise(t=>{const n=new Image;n.src=e,n.onload=()=>{k.add(e),t(null)}})}(a),(0,w.jsx)("img",{className:n||void 0,src:a,alt:t,ref:l,"data-position":r,style:{display:"block",height:i,width:s},draggable:"false"})}function E(e){let{activeEditor:t,nodeKey:n,onClose:l}=e;const a=t.getEditorState().read(()=>(0,d.ns)(n)),[s,i]=(0,u.useState)(a.getAltText()),[r,o]=(0,u.useState)(a.getShowCaption()),[c,p]=(0,u.useState)(a.getPosition());return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{style:{marginBottom:"1em"},children:(0,w.jsx)(C.A,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:i,value:s,"data-test-id":"image-modal-alt-text-input"})}),(0,w.jsxs)(j.A,{style:{marginBottom:"1em",width:"208px"},value:c,label:"Position",name:"position",id:"position-select",onChange:e=>{p(e.target.value)},children:[(0,w.jsx)("option",{value:"left",children:"Left"}),(0,w.jsx)("option",{value:"right",children:"Right"}),(0,w.jsx)("option",{value:"full",children:"Full Width"})]}),(0,w.jsxs)("div",{className:"Input__wrapper",children:[(0,w.jsx)("input",{id:"caption",type:"checkbox",checked:r,onChange:e=>{o(e.target.checked)}}),(0,w.jsx)("label",{htmlFor:"caption",children:"Show Caption"})]}),(0,w.jsx)(x.i,{children:(0,w.jsx)(g.A,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const e={altText:s,position:c,showCaption:r};a&&t.update(()=>{a.update(e)}),l()})(),children:"Confirm"})})]})}function y(e){let{src:t,altText:n,nodeKey:g,width:x,height:j,showCaption:C,caption:k,position:y}=e;const[A,T]=(0,p.A)(),S=(0,u.useRef)(null),R=(0,u.useRef)(null),[D,N,M]=(0,o.Y)(g),[I]=(0,a.DF)(),[K,L]=(0,u.useState)(null),O=(0,u.useRef)(null),P=(0,u.useCallback)(e=>{if(D&&(0,d.RT)((0,d.vJ)())){e.preventDefault();const t=(0,d.ns)(g);(0,b.zq)(t)&&t.remove()}return!1},[D,g]),F=(0,u.useCallback)(e=>{const t=(0,d.vJ)(),n=R.current;if(D&&(0,d.RT)(t)&&1===t.getNodes().length){if(C)return(0,d.n1)(null),e.preventDefault(),k.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1},[k,D,C]),$=(0,u.useCallback)(e=>(O.current===k||R.current===e.target)&&((0,d.n1)(null),I.update(()=>{N(!0);const e=I.getRootElement();null!==e&&e.focus()}),!0),[k,I,N]);(0,u.useEffect)(()=>{let e=!0;const t=(0,c.Sd)(I.registerUpdateListener(t=>{let{editorState:n}=t;e&&L(n.read(()=>(0,d.vJ)()))}),I.registerCommand(d.Mv,(e,t)=>(O.current=t,!1),d.Ac),I.registerCommand(d.d8,e=>{const t=e;return t.target===S.current&&(t.shiftKey?N(!D):(M(),N(!0)),!0)},d.Ac),I.registerCommand(d.Tg,e=>e.target===S.current&&(e.preventDefault(),!0),d.Ac),I.registerCommand(d.w$,P,d.Ac),I.registerCommand(d.gC,P,d.Ac),I.registerCommand(d.if,F,d.Ac),I.registerCommand(d.Q$,$,d.Ac));return()=>{e=!1,t()}},[M,I,D,g,P,F,$,N]);const B=D&&(0,d.RT)(K),U=D;return(0,w.jsxs)(u.Suspense,{fallback:null,children:[(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{draggable:B,children:[(0,w.jsx)("button",{className:"image-edit-button",ref:R,onClick:()=>{T("Update Inline Image",e=>(0,w.jsx)(E,{activeEditor:I,nodeKey:g,onClose:e}))},children:"Edit"}),(0,w.jsx)(_,{className:U?"focused "+((0,d.RT)(K)?"draggable":""):null,src:t,altText:n,imageRef:S,width:x,height:j,position:y})]}),C&&(0,w.jsx)("div",{className:"image-caption-container",children:(0,w.jsxs)(i.s,{initialEditor:k,children:[(0,w.jsx)(l.x,{}),(0,w.jsx)(f.A,{}),(0,w.jsx)(h.A,{}),(0,w.jsx)(r.$,{contentEditable:(0,w.jsx)(m.A,{className:"InlineImageNode__contentEditable"}),placeholder:(0,w.jsx)(v.A,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:s.LexicalErrorBoundary})]})})]}),A]})}},8268:(e,t,n)=>{n.d(t,{s:()=>d});var l=n(9593),a=n(5532),s=n(5043),i=n(579);var r,o=(r=function(e){const t=new URLSearchParams;t.append("code",e);for(let n=1;n<arguments.length;n++)t.append("v",arguments[n]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;function c(e){const t=e.transform();return null!==t?new Set([t]):new Set}function d(e){let{initialEditor:t,children:n,initialNodes:r,initialTheme:d,skipCollabChecks:u}=e;const p=(0,s.useRef)(!1),h=(0,s.useContext)(a.Gu);null==h&&o(9);const[f,{getTheme:g}]=h,m=(0,s.useMemo)(()=>{const e=d||g()||void 0,n=(0,a.Mx)(h,e);if(void 0!==e&&(t._config.theme=e),t._parentEditor=f,r)for(let l of r){let e=null,n=null;if("function"!=typeof l){const t=l;l=t.replace,e=t.with,n=t.withKlass||null}const a=t._nodes.get(l.getType());t._nodes.set(l.getType(),{exportDOM:a?a.exportDOM:void 0,klass:l,replace:e,replaceWithKlass:n,transforms:c(l)})}else{const e=t._nodes=new Map(f._nodes);for(const[n,l]of e)t._nodes.set(n,{exportDOM:l.exportDOM,klass:l.klass,replace:l.replace,replaceWithKlass:l.replaceWithKlass,transforms:c(l.klass)})}return t._config.namespace=f._config.namespace,t._editable=f._editable,[t,n]},[]),{isCollabActive:x,yjsDocMap:v}=(0,l.k)(),j=u||p.current||v.has(t.getKey());return(0,s.useEffect)(()=>{j&&(p.current=!0)},[j]),(0,s.useEffect)(()=>f.registerEditableListener(e=>{t.setEditable(e)}),[t,f]),(0,i.jsx)(a.Gu.Provider,{value:m,children:!x||j?n:null})}}}]);
//# sourceMappingURL=979.702f9c90.chunk.js.map