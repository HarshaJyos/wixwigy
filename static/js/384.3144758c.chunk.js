"use strict";(self.webpackChunkcodox_lexical=self.webpackChunkcodox_lexical||[]).push([[384],{2723:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(5043),s=r(579);function i(e,t,r){return Math.min(Math.max(e,t),r)}const o={east:1,north:8,south:2,west:4};function a(e){let{onResizeStart:t,onResizeEnd:r,buttonRef:a,imageRef:l,maxWidth:c,editor:u,showCaption:d,setShowCaption:h,captionsEnabled:m}=e;const g=(0,n.useRef)(null),p=(0,n.useRef)({priority:"",value:"default"}),f=(0,n.useRef)({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),x=u.getRootElement(),w=c||(null!==x?x.getBoundingClientRect().width-20:100),v=null!==x?x.getBoundingClientRect().height-20:100,y=(e,r)=>{if(!u.isEditable())return;const n=l.current,s=g.current;if(null!==n&&null!==s){e.preventDefault();const{width:i,height:a}=n.getBoundingClientRect(),l=f.current;l.startWidth=i,l.startHeight=a,l.ratio=i/a,l.currentWidth=i,l.currentHeight=a,l.startX=e.clientX,l.startY=e.clientY,l.isResizing=!0,l.direction=r,(e=>{const t=e===o.east||e===o.west,r=e===o.north||e===o.south,n=e&o.north&&e&o.west||e&o.south&&e&o.east,s=t?"ew":r?"ns":n?"nwse":"nesw";null!==x&&x.style.setProperty("cursor",`${s}-resize`,"important"),null!==document.body&&(document.body.style.setProperty("cursor",`${s}-resize`,"important"),p.current.value=document.body.style.getPropertyValue("-webkit-user-select"),p.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))})(r),t(),s.classList.add("image-control-wrapper--resizing"),n.style.height=`${a}px`,n.style.width=`${i}px`,document.addEventListener("pointermove",b),document.addEventListener("pointerup",C)}},b=e=>{const t=l.current,r=f.current,n=r.direction&(o.east|o.west),s=r.direction&(o.south|o.north);if(null!==t&&r.isResizing)if(n&&s){let n=Math.floor(r.startX-e.clientX);n=r.direction&o.east?-n:n;const s=i(r.startWidth+n,100,w),a=s/r.ratio;t.style.width=`${s}px`,t.style.height=`${a}px`,r.currentHeight=a,r.currentWidth=s}else if(s){let n=Math.floor(r.startY-e.clientY);n=r.direction&o.south?-n:n;const s=i(r.startHeight+n,100,v);t.style.height=`${s}px`,r.currentHeight=s}else{let n=Math.floor(r.startX-e.clientX);n=r.direction&o.east?-n:n;const s=i(r.startWidth+n,100,w);t.style.width=`${s}px`,r.currentWidth=s}},C=()=>{const e=l.current,t=f.current,n=g.current;if(null!==e&&null!==n&&t.isResizing){const e=t.currentWidth,s=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,n.classList.remove("image-control-wrapper--resizing"),null!==x&&x.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",p.current.value,p.current.priority)),r(e,s),document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",C)}};return(0,s.jsxs)("div",{ref:g,children:[!d&&m&&(0,s.jsx)("button",{className:"image-caption-button",ref:a,onClick:()=>{h(!d)},children:"Add Caption"}),(0,s.jsx)("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{y(e,o.north)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{y(e,o.north|o.east)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{y(e,o.east)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{y(e,o.south|o.east)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{y(e,o.south)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{y(e,o.south|o.west)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{y(e,o.west)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{y(e,o.north|o.west)}})]})}},8003:(e,t,r)=>{r.r(t),r.d(t,{RIGHT_CLICK_IMAGE_COMMAND:()=>j,default:()=>_});var n=r(9019),s=r(5532),i=r(9837),o=r(2242),a=r(4710),l=r(8268),c=r(9887),u=r(4736),d=r(8578),h=r(407),m=r(5043),g=r(1099),p=r(3649),f=r(34),x=r(6716),w=r(8995),v=r(2031),y=r(2723),b=r(5138),C=r(4692),E=r(579);const R=new Set,j=(0,h.gu)("RIGHT_CLICK_IMAGE_COMMAND");function z(e){let{altText:t,className:r,imageRef:n,src:s,width:i,height:o,maxWidth:a}=e;return function(e){if(!R.has(e))throw new Promise(t=>{const r=new Image;r.src=e,r.onload=()=>{R.add(e),t(null)}})}(s),(0,E.jsx)("img",{className:r||void 0,src:s,alt:t,ref:n,style:{height:o,maxWidth:a,width:i},draggable:"false"})}function _(e){let{src:t,altText:r,nodeKey:R,width:_,height:A,maxWidth:M,resizable:N,showCaption:k,caption:D,captionsEnabled:P}=e;const W=(0,m.useRef)(null),S=(0,m.useRef)(null),[T,H,L]=(0,u.Y)(R),[$,I]=(0,m.useState)(!1),[K]=(0,s.DF)(),[O,G]=(0,m.useState)(null),X=(0,m.useRef)(null),Y=(0,m.useCallback)(e=>{if(T&&(0,h.RT)((0,h.vJ)())){e.preventDefault();const t=(0,h.ns)(R);(0,C.Eh)(t)&&t.remove()}return!1},[T,R]),B=(0,m.useCallback)(e=>{const t=(0,h.vJ)(),r=S.current;if(T&&(0,h.RT)(t)&&1===t.getNodes().length){if(k)return(0,h.n1)(null),e.preventDefault(),D.focus(),!0;if(null!==r&&r!==document.activeElement)return e.preventDefault(),r.focus(),!0}return!1},[D,T,k]),J=(0,m.useCallback)(e=>(X.current===D||S.current===e.target)&&((0,h.n1)(null),K.update(()=>{H(!0);const e=K.getRootElement();null!==e&&e.focus()}),!0),[D,K,H]),F=(0,m.useCallback)(e=>{const t=e;return!!$||t.target===W.current&&(t.shiftKey?H(!T):(L(),H(!0)),!0)},[$,T,H,L]),U=(0,m.useCallback)(e=>{K.getEditorState().read(()=>{const t=(0,h.vJ)();"IMG"===e.target.tagName&&(0,h.I2)(t)&&1===t.getNodes().length&&K.dispatchCommand(j,e)})},[K]);(0,m.useEffect)(()=>{let e=!0;const t=K.getRootElement(),r=(0,d.Sd)(K.registerUpdateListener(t=>{let{editorState:r}=t;e&&G(r.read(()=>(0,h.vJ)()))}),K.registerCommand(h.Mv,(e,t)=>(X.current=t,!1),h.Ac),K.registerCommand(h.d8,F,h.Ac),K.registerCommand(j,F,h.Ac),K.registerCommand(h.Tg,e=>e.target===W.current&&(e.preventDefault(),!0),h.Ac),K.registerCommand(h.w$,Y,h.Ac),K.registerCommand(h.gC,Y,h.Ac),K.registerCommand(h.if,B,h.Ac),K.registerCommand(h.Q$,J,h.Ac));return null===t||void 0===t||t.addEventListener("contextmenu",U),()=>{e=!1,r(),null===t||void 0===t||t.removeEventListener("contextmenu",U)}},[L,K,$,T,R,Y,B,J,F,U,H]);const{historyState:Q}=(0,g.O)(),V=T&&(0,h.RT)(O)&&!$,q=T||$;return(0,E.jsx)(m.Suspense,{fallback:null,children:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{draggable:V,children:(0,E.jsx)(z,{className:q?"focused "+((0,h.RT)(O)?"draggable":""):null,src:t,altText:r,imageRef:W,width:_,height:A,maxWidth:M})}),k&&(0,E.jsx)("div",{className:"image-caption-container",children:(0,E.jsxs)(l.s,{initialEditor:D,children:[(0,E.jsx)(n.x,{}),(0,E.jsx)(w.A,{}),(0,E.jsx)(x.A,{}),(0,E.jsx)(p.A,{}),(0,E.jsx)(o.E,{}),(0,E.jsx)(f.A,{}),(0,E.jsx)(a.G,{externalHistoryState:Q}),(0,E.jsx)(c.$,{contentEditable:(0,E.jsx)(v.A,{className:"ImageNode__contentEditable"}),placeholder:(0,E.jsx)(b.A,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:i.default})]})}),N&&(0,h.RT)(O)&&q&&(0,E.jsx)(y.A,{showCaption:k,setShowCaption:()=>{K.update(()=>{const e=(0,h.ns)(R);(0,C.Eh)(e)&&e.setShowCaption(!0)})},editor:K,buttonRef:S,imageRef:W,maxWidth:M,onResizeStart:()=>{I(!0)},onResizeEnd:(e,t)=>{setTimeout(()=>{I(!1)},200),K.update(()=>{const r=(0,h.ns)(R);(0,C.Eh)(r)&&r.setWidthAndHeight(e,t)})},captionsEnabled:P})]})})}},8268:(e,t,r)=>{r.d(t,{s:()=>u});var n=r(9593),s=r(5532),i=r(5043),o=r(579);var a,l=(a=function(e){const t=new URLSearchParams;t.append("code",e);for(let r=1;r<arguments.length;r++)t.append("v",arguments[r]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;function c(e){const t=e.transform();return null!==t?new Set([t]):new Set}function u(e){let{initialEditor:t,children:r,initialNodes:a,initialTheme:u,skipCollabChecks:d}=e;const h=(0,i.useRef)(!1),m=(0,i.useContext)(s.Gu);null==m&&l(9);const[g,{getTheme:p}]=m,f=(0,i.useMemo)(()=>{const e=u||p()||void 0,r=(0,s.Mx)(m,e);if(void 0!==e&&(t._config.theme=e),t._parentEditor=g,a)for(let n of a){let e=null,r=null;if("function"!=typeof n){const t=n;n=t.replace,e=t.with,r=t.withKlass||null}const s=t._nodes.get(n.getType());t._nodes.set(n.getType(),{exportDOM:s?s.exportDOM:void 0,klass:n,replace:e,replaceWithKlass:r,transforms:c(n)})}else{const e=t._nodes=new Map(g._nodes);for(const[r,n]of e)t._nodes.set(r,{exportDOM:n.exportDOM,klass:n.klass,replace:n.replace,replaceWithKlass:n.replaceWithKlass,transforms:c(n.klass)})}return t._config.namespace=g._config.namespace,t._editable=g._editable,[t,r]},[]),{isCollabActive:x,yjsDocMap:w}=(0,n.k)(),v=d||h.current||w.has(t.getKey());return(0,i.useEffect)(()=>{v&&(h.current=!0)},[v]),(0,i.useEffect)(()=>g.registerEditableListener(e=>{t.setEditable(e)}),[t,g]),(0,o.jsx)(s.Gu.Provider,{value:f,children:!x||v?r:null})}}}]);
//# sourceMappingURL=384.3144758c.chunk.js.map