"use strict";(self.webpackChunkcodox_lexical=self.webpackChunkcodox_lexical||[]).push([[157],{1157:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var i=n(5532),s=n(4736),r=n(8578),o=n(407),l=n(5043),a=n(2723),c=n(3926),u=n(9472),d=n(579);const h=e=>{var t;const n=null===e||void 0===e||null===(t=e.firstElementChild)||void 0===t?void 0:t.firstElementChild,i=e.getAttribute("viewBox");if(null!=i){const t=i.split(" ");e.setAttribute("width",t[2]),e.setAttribute("height",t[3])}n&&"style"===n.tagName&&n.remove()};function m(e){var t;let{elements:n,files:i,imageContainerRef:s,appState:r,rootClassName:o=null}=e;const[a,c]=(0,l.useState)(null);return(0,l.useEffect)(()=>{(async()=>{const e=await(0,u.exportToSvg)({appState:r,elements:n,files:i});h(e),e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.setAttribute("display","block"),c(e)})()},[n,i,r]),(0,d.jsx)("div",{ref:s,className:null!==o&&void 0!==o?o:"",dangerouslySetInnerHTML:{__html:null!==(t=null===a||void 0===a?void 0:a.outerHTML)&&void 0!==t?t:""}})}var g=n(7950),p=n(2317),f=n(8549);const v=()=>{const[e,t]=l.useState(null);return[e,l.useCallback(e=>t(e),[])]};function w(e){let{closeOnClickOutside:t=!1,onSave:n,initialElements:i,initialAppState:s,initialFiles:r,isShown:o=!1,onDelete:a,onClose:c}=e;const h=(0,l.useRef)(null),[m,w]=v(),[x,b]=(0,l.useState)(!1),[y,E]=(0,l.useState)(i),[C,k]=(0,l.useState)(r);(0,l.useEffect)(()=>{null!==h.current&&h.current.focus()},[]),(0,l.useEffect)(()=>{let e=null;const n=e=>{const n=e.target;null!==h.current&&!h.current.contains(n)&&t&&a()};var i,s;null!==h.current&&(e=null===(i=h.current)||void 0===i?void 0:i.parentElement,null!==e&&(null===(s=e)||void 0===s||s.addEventListener("click",n)));return()=>{var t;null!==e&&(null===(t=e)||void 0===t||t.removeEventListener("click",n))}},[t,a]),(0,l.useLayoutEffect)(()=>{const e=h.current,t=e=>{"Escape"===e.key&&a()};return null!==e&&e.addEventListener("keydown",t),()=>{null!==e&&e.removeEventListener("keydown",t)}},[y,C,a]);function z(){return(0,d.jsxs)(f.A,{title:"Discard",onClose:()=>{b(!1)},closeOnClickOutside:!1,children:["Are you sure you want to discard the changes?",(0,d.jsxs)("div",{className:"ExcalidrawModal__discardModal",children:[(0,d.jsx)(p.A,{onClick:()=>{b(!1),c()},children:"Discard"})," ",(0,d.jsx)(p.A,{onClick:()=>{b(!1)},children:"Cancel"})]})]})}if(!1===o)return null;return(0,g.createPortal)((0,d.jsx)("div",{className:"ExcalidrawModal__overlay",role:"dialog",children:(0,d.jsx)("div",{className:"ExcalidrawModal__modal",ref:h,tabIndex:-1,children:(0,d.jsxs)("div",{className:"ExcalidrawModal__row",children:[x&&(0,d.jsx)(z,{}),(0,d.jsx)(u.Excalidraw,{onChange:(e,t,n)=>{E(e),k(n)},excalidrawAPI:w,initialData:{appState:s||{isLoading:!1},elements:i,files:r}}),(0,d.jsxs)("div",{className:"ExcalidrawModal__actions",children:[(0,d.jsx)("button",{className:"action-button",onClick:()=>{0===y.filter(e=>!e.isDeleted).length?a():b(!0)},children:"Discard"}),(0,d.jsx)("button",{className:"action-button",onClick:()=>{if(y.filter(e=>!e.isDeleted).length>0){const e=null===m||void 0===m?void 0:m.getAppState(),t={exportBackground:e.exportBackground,exportScale:e.exportScale,exportWithDarkMode:"dark"===e.theme,isBindingEnabled:e.isBindingEnabled,isLoading:e.isLoading,name:e.name,theme:e.theme,viewBackgroundColor:e.viewBackgroundColor,viewModeEnabled:e.viewModeEnabled,zenModeEnabled:e.zenModeEnabled,zoom:e.zoom};n(y,t,C)}else a()},children:"Save"})]})]})})}),document.body)}function x(e){let{nodeKey:t,data:n,height:u,width:h}=e;const[g]=(0,i.DF)(),[p,f]=(0,l.useState)("[]"===n&&g.isEditable()),v=(0,l.useRef)(null),x=(0,l.useRef)(null),b=(0,l.useRef)(null),[y,E,C]=(0,s.Y)(t),[k,z]=(0,l.useState)(!1);(0,l.useEffect)(()=>{v&&v.current&&(v.current.style.width="inherit"===h?h:`${h}px`,v.current.style.height="inherit"===u?u:`${u}px`)},[u,h]);const S=(0,l.useCallback)(e=>(y&&(0,o.RT)((0,o.vJ)())&&(e.preventDefault(),g.update(()=>{const e=(0,o.ns)(t);(0,c.d1)(e)&&e.remove()})),!1),[g,y,t]);(0,l.useEffect)(()=>{p?g.setEditable(!1):g.setEditable(!0)},[p,g]),(0,l.useEffect)(()=>(0,r.Sd)(g.registerCommand(o.d8,e=>{const t=x.current,n=e.target;return!!k||!(null===t||!t.contains(n))&&(e.shiftKey||C(),E(!y),e.detail>1&&f(!0),!0)},o.Ac),g.registerCommand(o.w$,S,o.Ac),g.registerCommand(o.gC,S,o.Ac)),[C,g,y,k,S,E]);const j=(0,l.useCallback)(()=>(f(!1),g.update(()=>{const e=(0,o.ns)(t);(0,c.d1)(e)&&e.remove()})),[g,t]),R=(0,l.useCallback)(()=>{f(!0)},[]),{elements:N=[],files:D={},appState:A={}}=(0,l.useMemo)(()=>JSON.parse(n),[n]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(w,{initialElements:N,initialFiles:D,initialAppState:A,isShown:p,onDelete:j,onClose:()=>f(!1),onSave:(e,n,i)=>{g.setEditable(!0),((e,n,i)=>{if(g.isEditable())g.update(()=>{const s=(0,o.ns)(t);(0,c.d1)(s)&&(e.length>0||Object.keys(i).length>0?s.setData(JSON.stringify({appState:n,elements:e,files:i})):s.remove())})})(e,n,i),f(!1)},closeOnClickOutside:!1}),N.length>0&&(0,d.jsxs)("button",{ref:x,className:"excalidraw-button "+(y?"selected":""),children:[(0,d.jsx)(m,{imageContainerRef:v,className:"image",elements:N,files:D,appState:A}),y&&(0,d.jsx)("div",{className:"image-edit-button",role:"button",tabIndex:0,onMouseDown:e=>e.preventDefault(),onClick:R}),(y||k)&&(0,d.jsx)(a.A,{buttonRef:b,showCaption:!0,setShowCaption:()=>null,imageRef:v,editor:g,onResizeStart:()=>{z(!0)},onResizeEnd:(e,n)=>{setTimeout(()=>{z(!1)},200),g.update(()=>{const i=(0,o.ns)(t);(0,c.d1)(i)&&(i.setWidth(e),i.setHeight(n))})},captionsEnabled:!0})]})]})}},2723:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(5043),s=n(579);function r(e,t,n){return Math.min(Math.max(e,t),n)}const o={east:1,north:8,south:2,west:4};function l(e){let{onResizeStart:t,onResizeEnd:n,buttonRef:l,imageRef:a,maxWidth:c,editor:u,showCaption:d,setShowCaption:h,captionsEnabled:m}=e;const g=(0,i.useRef)(null),p=(0,i.useRef)({priority:"",value:"default"}),f=(0,i.useRef)({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),v=u.getRootElement(),w=c||(null!==v?v.getBoundingClientRect().width-20:100),x=null!==v?v.getBoundingClientRect().height-20:100,b=(e,n)=>{if(!u.isEditable())return;const i=a.current,s=g.current;if(null!==i&&null!==s){e.preventDefault();const{width:r,height:l}=i.getBoundingClientRect(),a=f.current;a.startWidth=r,a.startHeight=l,a.ratio=r/l,a.currentWidth=r,a.currentHeight=l,a.startX=e.clientX,a.startY=e.clientY,a.isResizing=!0,a.direction=n,(e=>{const t=e===o.east||e===o.west,n=e===o.north||e===o.south,i=e&o.north&&e&o.west||e&o.south&&e&o.east,s=t?"ew":n?"ns":i?"nwse":"nesw";null!==v&&v.style.setProperty("cursor",`${s}-resize`,"important"),null!==document.body&&(document.body.style.setProperty("cursor",`${s}-resize`,"important"),p.current.value=document.body.style.getPropertyValue("-webkit-user-select"),p.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))})(n),t(),s.classList.add("image-control-wrapper--resizing"),i.style.height=`${l}px`,i.style.width=`${r}px`,document.addEventListener("pointermove",y),document.addEventListener("pointerup",E)}},y=e=>{const t=a.current,n=f.current,i=n.direction&(o.east|o.west),s=n.direction&(o.south|o.north);if(null!==t&&n.isResizing)if(i&&s){let i=Math.floor(n.startX-e.clientX);i=n.direction&o.east?-i:i;const s=r(n.startWidth+i,100,w),l=s/n.ratio;t.style.width=`${s}px`,t.style.height=`${l}px`,n.currentHeight=l,n.currentWidth=s}else if(s){let i=Math.floor(n.startY-e.clientY);i=n.direction&o.south?-i:i;const s=r(n.startHeight+i,100,x);t.style.height=`${s}px`,n.currentHeight=s}else{let i=Math.floor(n.startX-e.clientX);i=n.direction&o.east?-i:i;const s=r(n.startWidth+i,100,w);t.style.width=`${s}px`,n.currentWidth=s}},E=()=>{const e=a.current,t=f.current,i=g.current;if(null!==e&&null!==i&&t.isResizing){const e=t.currentWidth,s=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,i.classList.remove("image-control-wrapper--resizing"),null!==v&&v.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",p.current.value,p.current.priority)),n(e,s),document.removeEventListener("pointermove",y),document.removeEventListener("pointerup",E)}};return(0,s.jsxs)("div",{ref:g,children:[!d&&m&&(0,s.jsx)("button",{className:"image-caption-button",ref:l,onClick:()=>{h(!d)},children:"Add Caption"}),(0,s.jsx)("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{b(e,o.north)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{b(e,o.north|o.east)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{b(e,o.east)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{b(e,o.south|o.east)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{b(e,o.south)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{b(e,o.south|o.west)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{b(e,o.west)}}),(0,s.jsx)("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{b(e,o.north|o.west)}})]})}}}]);
//# sourceMappingURL=157.f2b3b8fb.chunk.js.map